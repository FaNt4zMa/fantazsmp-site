<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fantaz's SMP - Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent1-light: hsl(280, 76%, 34%);
      --accent1-dark: hsl(280, 76%, 17%);
      --accent1-light-opacity1: hsl(280, 76%, 34%, 0.4);
      --accent2-light: hsl(120, 76%, 34%);
      --accent2-dark: hsl(120, 76%, 17%);
      --bg: #2e2e2e;
      --bg-elev: #3a3a3a;
      --text: #f0f0f0;
      --muted: #bbbbbb;
      --chip-active: #555;
      --chip-hover: #4a4a4a;
      --overlay: rgba(0,0,0,0.6);
      --overlay-hover: rgba(0,0,0,0.8);
      --radius: 12px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    header {
      text-align: center;
      padding: 1rem;
    }
    header h1 {
      margin: 0;
      font-size: clamp(1.6rem, 2.5vw + 1rem, 2.5rem);
      font-family: 'Quicksand', sans-serif;
      font-weight: 600;
    }
    header p {
      margin: .5rem 0 0;
      color: var(--muted);
    }

    /* Nav buttons */
    nav {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: .5rem;
      padding: .75rem;
      font-family: 'Quicksand', sans-serif;
      font-size: 1.05rem;
    }
    nav a {
      background: var(--bg-elev);
      color: #f0f0f0;
      padding: 10px 18px;
      border-radius: var(--radius);
      text-decoration: none;
      box-shadow: 0 3px 8px rgba(0,0,0,0.35);
      transition: all 0.2s ease-in-out;
    }
    nav a:hover {
      background: var(--chip-hover);
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(0,0,0,0.5);
    }
    nav a.active {
      background: var(--chip-active);
      font-weight: bold;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.6);
    }

    main {
      display: grid;
      grid-template-columns: 420px 1fr;
      gap: 1.5rem;
      padding: 1.5rem;
    }

    .card {
      background: var(--bg-elev);
      border-radius: var(--radius);
      padding: 1.25rem;
      box-shadow: 0 4px 14px rgba(0,0,0,0.5);
    }

    /* Stats panel */
    .stats { text-align: center; font-family: 'Quicksand', sans-serif; }
    .stats h2 {
      text-decoration: none;
      margin: .25rem 0 1rem;
      font-size: 1.2rem;
      color: #eaeaea;
      letter-spacing: .3px;
    }

    .stat-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
    }
    .stat {
      background: #2f2f2f;
      border-radius: 10px;
      padding: .85rem .5rem;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.4);
    }
    .stat .label {
      display: block;
      font-size: .85rem;
      color: var(--muted);
      margin-bottom: .25rem;
    }
    .stat .value {
      display: block;
      font-weight: 600;
      font-size: 1.25rem;
      letter-spacing: .2px;
    }

    /* Map panel */
    .map {
      font-family: 'Quicksand', sans-serif;
      background: #222;
      border-radius: var(--radius);
      position: relative;
      overflow: hidden;
      padding: 0;
      min-height: 360px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.5);
    }
    .map iframe {
      width: 100%;
      height: 700px;
      border: none;
      display: block;
    }
    .map .map-header {
      position: absolute;
      bottom: 12px; left: 8px;
      z-index: 10;
    }
    .map .map-header a {
      text-decoration: none;
      background: var(--overlay);
      padding: .5rem .8rem;
      border-radius: 8px;
      color: #fff;
      font-size: .9rem;
      transition: background .2s ease, transform .06s ease;
      backdrop-filter: blur(3px);
    }
    .map .map-header a:hover  { background: var(--overlay-hover); }
    .map .map-header a:active { transform: scale(.97); }

    footer {
      text-align: center;
      padding: 1rem;
      font-size: .9rem;
      color: #aaa;
      margin-top: 2rem;
      font-family: 'Quicksand', sans-serif;
    }
    footer hr {
      border: none;
      border-top: 1px solid #444;
      margin-bottom: 10px;
    }

    /* Responsive */
    @media (max-width: 980px) {
      main { grid-template-columns: 1fr; }
      .map iframe { height: 420px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>MC Server Name (Logo?)</h1>
    <p>Small description goes here</p>
  </header>

  <nav>
    <a href="index" class="active">Home</a>
    <a href="info">Server Info</a>
    <a href="rules">Rules</a>
    <a href="join">How to Join?</a>
    <a href="modpack">My Modpack</a>
    <a href="map">Real Time Map</a>
  </nav>

  <main>
    <section class="card stats" aria-live="polite">
      <h2>Server Statistics</h2>
      <div class="stat-grid">
        <div class="stat">
          <span class="label">Uptime</span>
          <span id="uptime" class="value">Loading...</span>
        </div>
        <div class="stat">
          <span class="label">Players</span>
          <span id="players" class="value">Loading...</span>
        </div>
        <div class="stat">
          <span class="label">CPU / RAM</span>
          <span id="resources" class="value">Loading...</span>
        </div>
        <div class="stat">
          <span class="label">World Size</span>
          <span id="worldsize" class="value">Loading...</span>
        </div>
        <div class="stat">
          <span class="label">MOTD</span>
          <span id="motd" class="value">Loading...</span>
        </div>
        <div class="stat">
          <span class="label">Version</span>
          <span id="version" class="value">Loading...</span>
        </div>
      </div>
    </section>

    <section class="map card" aria-label="World Map">
      <div class="map-header">
        <a id="map-fullscreen" href="" target="_blank" rel="noopener">View Fullscreen</a>
      </div>
      <iframe id="map-iframe" src=""></iframe>
    </section>
  </main>

  <footer>
    <hr>
    © 2025 Your Server Name — All Rights Reserved
  </footer>

  <script src="config.js"></script>
  <script>
    
    document.getElementById("map-iframe").src = CONFIG.mapUrl;
    document.getElementById("map-fullscreen").href = CONFIG.mapUrl;

    const $ = (sel) => document.querySelector(sel);

    function safeParseDate(dt) {
      if (!dt) return NaN;
      const m = dt.match(/^(\d{4}-\d{2}-\d{2}) (\d{2}:\d{2}:\d{2})$/);
      if (m) {
        return Date.parse(m[1] + "T" + m[2] + "Z");
      }
      return Date.parse(dt);
    }

    function formatUptimeFromStarted(started) {
      const start = safeParseDate(started);
      if (isNaN(start)) return "—";
      const diff = Math.floor((Date.now() - start) / 1000);
      const d = Math.floor(diff / 86400);
      const h = Math.floor((diff % 86400) / 3600);
      const m = Math.floor((diff % 3600) / 60);
      return `${d}d ${h}h ${m}m`;
    }

    function setOffline() {
      ["#uptime","#players","#resources","#worldsize","#motd","#version"]
        .forEach(sel => $(sel).textContent = "Offline");
    }

    async function fetchCrafty() {
      const url = `/api/v2/servers/${CONFIG.serverId}/stats`;
      const controller = new AbortController();
      const t = setTimeout(() => controller.abort(), 8000);

      try {
        const res = await fetch(url, {
          headers: {
            'Accept': 'application/json'
          },
          signal: controller.signal,
          cache: 'no-store'
        });
        clearTimeout(t);

        if (!res.ok) throw new Error(`Crafty API error ${res.status}`);
        const json = await res.json();
        const data = json?.data ?? json;

        if (!data || data.running === false) {
          setOffline();
          return;
        }
        
        $("#uptime").textContent    = formatUptimeFromStarted(data.started);
        $("#players").textContent   = `${data.online}/${data.max}`;
        $("#resources").textContent = `${data.cpu}% CPU / ${data.mem_percent}% RAM (${data.mem})`;
        $("#worldsize").textContent = data.world_size || "—";
        $("#motd").textContent      = data.desc || "—";
        $("#version").textContent   = data.version || "—";

      } catch (err) {
        console.error('fetchCrafty error:', err);
        setOffline();
      }
    }

    fetchCrafty();
    setInterval(fetchCrafty, CONFIG.pollMs);

  </script>
</body>
</html>
